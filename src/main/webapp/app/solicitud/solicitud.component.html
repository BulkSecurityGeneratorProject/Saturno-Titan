<ngb-accordion #acc="ngbAccordion" [closeOthers]="true" [activeIds]="activeIds" (panelChange)="beforeChange($event)">
    <ngb-panel id="toggle-1" title="Datos del turno" [disabled]="disable_toggle_1">
        <ng-template ngbPanelContent>
            <div class="row" style="width:1000px;">
            </div>
            <div class="row">
                <div class="col-md-12">
                    <p class="lead" jhiTranslate="solicitud.vehiculo">Vehicle data</p>
                    <div class="row">
                        <div class="form-group col-md-3">
                            <label class="form-control-label" jhiTranslate="solicitud.form.marca">Brand</label>
                            <select class="form-control" id="marca" name="marca" [(ngModel)]="marcaSelected" (change)="refreshMarcas()" required>
                                <option *ngFor="let marca of marcas">{{marca}}</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="form-control-label" jhiTranslate="solicitud.form.modelo">Model</label>
                            <select class="form-control" id="modelo" name="modelo" [(ngModel)]="vehiculo.modeloId" (change)="refreshModeloNombre()" required>
                                <option [ngValue]="modelo.id" *ngFor="let modelo of modelosByMarca">{{modelo.nombre}}</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="form-control-label" jhiTranslate="solicitud.form.anio">Year</label>
                            <select class="form-control" id="anio" name="anio" [(ngModel)]="vehiculo.anio" required>
                                <option *ngFor="let anio of anios">{{anio}}</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="form-control-label" jhiTranslate="solicitud.form.kilometraje">Mileage</label>
                            <input type="number" class="form-control" id="kilometraje" name="kilometraje" min="1" [(ngModel)]="vehiculo.kilometraje" required>
                            </input>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.servicios">Services</label>
                            <br>
                            <div class="btn-group btn-group-toggle" ngbRadioGroup id="servicios" name="servicios" [(ngModel)]="solicitud.tipo_servicio" (change)="refreshTipos()">
                                <label class="btn-primary" ngbButtonLabel *ngFor="let tipo_servicio of tiposDeServicios;let index = index">
                                    <input type="radio" ngbButton [value]="tipo_servicio"> {{tipo_servicio}}
                                </label>
                            </div>
                            <hr>
                            <label class="form-control-label" jhiTranslate="solicitud.form.adicionales">Additionals</label>
                            <br>
                            <div class="btn-group btn-group-toggle" id="adicionales" name="adicionales">
                                <label class="btn-primary" ngbButtonLabel *ngFor="let adicional of adicionales;let index = index">
                                    <input type="checkbox" ngbButton [(ngModel)]="solicitud.adicionales[index]" [valueChecked]="adicional" [valueUnChecked]="null"> {{adicional.nombre}}
                                </label>
                            </div>
                            <hr>
                            <label class="form-control-label" jhiTranslate="solicitud.form.detalle">Services detail</label>
                            <ul class="list-group">
                                <ng-template #popContent>
                                    <b>INSPECCION
                                    </b>
                                    <small *ngFor="let tarea of solicitud.servicio.tareas">
                                        <ul class="list-group" *ngIf="tarea.tipo==='INSPECCION'">{{tarea.descripcion}}</ul>
                                    </small>
                                    <b *ngIf="solicitud.servicio.tareas.length">CAMBIO
                                    </b>
                                    <small *ngFor="let tarea of solicitud.servicio.tareas">
                                        <ul class="list-group" *ngIf="tarea.tipo==='CAMBIO'">{{tarea.descripcion}}</ul>
                                    </small>
                                </ng-template>
                                <ng-template #popTitle>
                                    <small>Tareas a realizar
                                    </small>
                                </ng-template>
                                <li class="list-group-item d-flex justify-content-between align-items-center"
                                [ngbPopover]="popContent" triggers="mouseenter:mouseleave" [popoverTitle]="popTitle" placement="bottom">
                                    <div class="col-md-10">
                                        {{solicitud.tipo_servicio}}
                                        <br>
                                        <select class="form-control" style="overflow: hidden" [(ngModel)]="solicitud.servicio" required>
                                            <option *ngFor="let servicio of serviciosByTipo;let index = index" [(ngValue)]="serviciosByTipo[index]">{{servicio.nombre}}</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="badge badge-primary badge-pill">{{solicitud.servicio.duracion}} min.</span>
                                        <span class="badge badge-success badge-pill">$ {{solicitud.servicio.precio}}</span>
                                    </div>
                                </li>
                                <ng-container *ngFor="let adicional of solicitud.adicionales;let index = index">
                                    <li *ngIf="adicional" class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="col-md-10">
                                            {{adicional.nombre}}
                                        </div>
                                        <div class="col-md-2">
                                          <span class="badge badge-primary badge-pill">{{solicitud.adicionales[index].duracion}} min.</span>
                                          <span class="badge badge-success badge-pill">$ {{solicitud.adicionales[index].precio}}</span>
                                        </div>
                                    </li>
                                </ng-container>
                            </ul>
                        </div>
                        <div class="form-group col-md-6" style="overflow: hidden">
                            <label class="form-control-label" jhiTranslate="solicitud.form.fecha">Date</label>
                            <br>
                            <ngb-datepicker style="margin: auto" #dp [(ngModel)]="solicitud.fecha" (select)="checkHorarios()"
                            [markDisabled]="isDisabled" [displayMonths]="2" outsideDays="collapsed" navigation="none" name="date"></ngb-datepicker>
                            <div *ngIf="solicitud.fecha">
                                <br>
                                <label class="form-control-label" jhiTranslate="solicitud.form.hora">Time</label>
                                <br>
                                <div class="btn-group btn-group-toggle" style="margin: auto" ngbRadioGroup id="hora" name="hora" [(ngModel)]="solicitud.horario">
                                    <label class="btn-primary" ngbButtonLabel *ngFor="let horario of horarios;let index = index">
                                        <input type="radio" ngbButton [value]="horarios[index].hora" [(disabled)]="horarios[index].disabled"> {{horario.hora}}
                                    </label>
                                </div>
                                <br>
                                <br>
                                <div class="btn-group btn-group-toggle" ngbRadioGroup *ngIf="solicitud.horario" id="hora" name="hora" [(ngModel)]="solicitud.horario2">
                                    <label class="btn-primary" ngbButtonLabel>
                                        <input type="radio" ngbButton value="00"> {{solicitud.horario}}:00
                                    </label>
                                    <label class="btn-primary" ngbButtonLabel>
                                        <input type="radio" ngbButton value="15"> {{solicitud.horario}}:15
                                    </label>
                                    <label class="btn-primary" ngbButtonLabel>
                                        <input type="radio" ngbButton value="30"> {{solicitud.horario}}:30
                                    </label>
                                    <label class="btn-primary" ngbButtonLabel>
                                        <input type="radio" ngbButton value="45"> {{solicitud.horario}}:45
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="form-group col-md-12">
                        <label class="form-control-label" jhiTranslate="solicitud.form.comentarios">Comments</label>
                        <textarea class="form-control" style="resize:none" id="comentarios" name="comentarios" rows="3" [(ngModel)]="turno.comentario">
                        </textarea>
                    </div>
                    <div *ngIf="(vehiculo.kilometraje)&&(solicitud.fecha)&&(solicitud.horario)&&(solicitud.horario2)">
                        <button type="submit" class="btn btn-primary" style="float: right" jhiTranslate="solicitud.form.siguiente" (click)="toggleAccordion2()">Next</button>
                    </div>
                </div>
            </div>
        </ng-template>
    </ngb-panel>
    <ngb-panel id="toggle-2" title="Datos personales" [disabled]="disable_toggle_2">
        <ng-template ngbPanelContent>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label class="form-control-label" jhiTranslate="solicitud.form.nombre">Name</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" [(ngModel)]="cliente.nombre" maxlength="20" required>
                            </input>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="form-control-label" jhiTranslate="solicitud.form.apellido">Last name</label>
                            <input type="text" class="form-control" id="apellido" name="apellido" [(ngModel)]="cliente.apellido" maxlength="20" required>
                            </input>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="form-control-label" jhiTranslate="solicitud.form.patente">Licence plate</label>
                            <small>(XXX999/XX999XX)</small>
                            <input type="text" class="form-control" id="patente" name="patente" [(ngModel)]="vehiculo.patente" minlength="6" maxlength="7" pattern="^[A-Z]{2}[0-9]{3}[A-Z]{2}|[A-Z]{3}[0-9]{3}$" required>
                            </input>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label class="form-control-label" jhiTranslate="solicitud.form.correo">Email</label>
                            <input type="text" class="form-control" id="correo" name="correo" [(ngModel)]="cliente.email" maxlength="30" required>
                            </input>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="form-control-label" jhiTranslate="solicitud.form.telefono">Phone</label>
                            <input type="text" class="form-control" id="telefono" name="telefono" [(ngModel)]="cliente.telefono" maxlength="10">
                            </input>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="form-control-label" jhiTranslate="solicitud.form.celular">Cellphone</label>
                            <input type="text" class="form-control" id="celular" name="celular" [(ngModel)]="cliente.celular" maxlength="10">
                            </input>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <button class="btn" style="float: left" jhiTranslate="solicitud.form.anterior" (click)="toggleAccordion1()">Previous</button>
                        </div>
                        <div class="form-group col-md-6" *ngIf="(cliente.nombre)&&(cliente.apellido)&&(cliente.email)
                                                                &&(isPatenteOk())">
                            <button class="btn btn-primary" style="float: right" jhiTranslate="solicitud.form.siguiente" (click)="toggleAccordion3()">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>
    </ngb-panel>
    <ngb-panel id="toggle-3" title="Confirmar turno" [disabled]="disable_toggle_3">
        <ng-template ngbPanelContent>
            <div *ngIf="turno.id" class="alert alert-primary" role="alert">
                <label jhiTranslate="solicitud.form.alerta-1">The request has been successfully registered. Your reservation code is:</label>
                <label class="font-weight-bold">{{turno.codigoReserva}}.</label>
                <label jhiTranslate="solicitud.form.alerta-2">A link to validate your turn has been sent to your email address.</label>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.cliente">Client</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{cliente.nombre + ' ' + cliente.apellido}}</small>
                          </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.correo">Email</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{cliente.email}}</small>
                        </div>
                    </div>
                    <div class="row" *ngIf="cliente.telefono">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.telefono">Phone</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{cliente.telefono}}</small>
                        </div>
                    </div>
                    <div class="row"  *ngIf="cliente.celular">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.celular">Cellphone</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{cliente.celular}}</small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.vehiculo">Vehicle</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{marcaSelected + ' ' + vehiculo.modeloNombre + ' ' + vehiculo.anio}}</small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.patente">Licence plate</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{vehiculo.patente}}</small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.kilometraje">Mileage</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{vehiculo.kilometraje}} km.</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.servicios">Services</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{solicitud.tipo_servicio + ' ' + solicitud.servicio.nombre}}</small>
                        </div>
                    </div>
                    <div class="row" *ngIf="solicitud.adicionales.length">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.adicionales">Additionals</label>
                        </div>
                        <div class="col-md-6">
                            <ng-container *ngFor="let adicional of solicitud.adicionales">
                                <small *ngIf="adicional">{{adicional.nombre}}</small><br>
                            </ng-container>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.fecha">Date</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{solicitud.fecha | date:'mediumDate'}}</small>
                        </div>
                    </div>
                    <div class="row" *ngIf="solicitud.horario !== ''">
                        <div class="col-md-6">
                            <label class="form-control-label" jhiTranslate="solicitud.form.hora">Time</label>
                        </div>
                        <div class="col-md-6">
                            <small>{{solicitud.horario}}:{{solicitud.horario2}}</small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-9">
                            <label class="form-control-label" jhiTranslate="solicitud.form.duraciones">Estimated cost and delay:</label>
                        </div>
                        <div class="col-md-3" style="text-align:right">
                            <span class="badge badge-primary badge-pill">{{turno.duracion}} min.</span>
                            <span class="badge badge-success badge-pill">$ {{turno.costo}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf="turno.comentario" class="form-group offset-md-3 col-md-6" style="text-align:center">
                <label class="form-control-label" jhiTranslate="solicitud.form.comentarios">Comments</label>
                <br>
                <small>{{turno.comentario}}</small>
            </div>
            <div class="row">
                <button [disabled]="isSaving" class="btn btn-primary" style="margin: auto" jhiTranslate="solicitud.form.confirmar" (click)="save()">Confirm turn</button>
            </div>
            <div class="row col-md-12">
                <button class="btn" style="float: left" jhiTranslate="solicitud.form.anterior" (click)="toggleAccordion2()">Previous</button>
            </div>
        </ng-template>
    </ngb-panel>
</ngb-accordion>
